<?php
/**
{% for line in header %}
 * {{ line }}
{% endfor %}
 */
{% if strict %}
declare(strict_types=1);
{% endif %}
{% if namespace %}

namespace {{ namespace }};
{% endif %}

use Railt\Compiler\Parser\Runtime as {{ class }}Runtime;
use Railt\Compiler\Lexer\NativeStateful as {{ class }}Lexer;

/**
 * This class has been auto-generated by the {{ self }}
 */
final class {{ class }} extends {{ class }}Runtime
{
    /**#@+
     * List of {{ class }}::class tokens defined as public constants
     */
    {% for k, def in tokens %}
public const {{ k }} = {{ k | string | raw }};
    {% endfor %}
/**#@-*/

    public function __construct()
    {
        parent::__construct(new {{ class }}Lexer({{ pattern | string | raw }}, {{ skip | array | replace({"\n":""," ":""}) | raw }}), [
            {% for key, rule in rules %}
                {{ key | value | raw }} =>
new \{{ rule.getClass() }}({%for a in rule.toArray%}{{a | value | replace({"\n": "", " ":""}) | raw}}{%if not loop.last%}, {%endif%}{% endfor %}),
            {% endfor %}
        ]);
    }

    /**
     * @return string Returns the lexer compilation date and time in RFC3339 format
     */
    public function getBuiltDate(): string
    {
        return {{ "now" | date("Y-m-d\TH:i:s.vP") | string | raw }};
    }
}
